```
#将语句的结束符号从分号;临时改为两个$$(可以是自定义)
-- 删除游标
drop procedure select_review;
DELIMITER $$
CREATE PROCEDURE select_review ( IN lx BIGINT,OUT result VARCHAR(255)) 
BEGIN

	DECLARE _email VARCHAR(32);
	DECLARE i BIGINT;
	DECLARE r VARCHAR(255);
	DECLARE s BIGINT DEFAULT 0;
	-- 遍历数据结束标志
	DECLARE done INT DEFAULT FALSE;
	-- 游标
	DECLARE r_name CURSOR FOR (SELECT email FROM u_user u JOIN company c ON u.company_id=c.id JOIN u_user_role ur ON u.id=ur.uid JOIN u_role r ON ur.rid=r.id WHERE ur.rid=lx AND c.id=11);
	-- 将结束标志绑定到游标
	DECLARE CONTINUE HANDLER FOR NOT FOUND SET done = TRUE;

SELECT COUNT(email) INTO i FROM u_user u JOIN company c ON u.company_id=c.id JOIN u_user_role ur ON u.id=ur.uid JOIN u_role r ON ur.rid=r.id WHERE ur.rid=lx AND c.id=11;
	-- 打开游标
	OPEN r_name;
	-- 遍历
	rLoop:LOOP
		-- 取值 赋值给变量，多个以,号分割
		FETCH r_name INTO _email;
		-- 判断是否继续循环
		IF done THEN
			LEAVE rLoop;-- 结束循环
		END IF;
		
		SET s=s+1;-- 循环一次加1
		IF(i=1) then
			SET r=CONCAT('[{"Push_MC":"',_email,'"}]');
		ELSEIF(s=1) THEN
			SET r=CONCAT('[{"Push_MC":"',_email,'"},');
		ELSEIF(s=i) THEN
			SET r=CONCAT(r,'{"Push_MC":"',_email,'"}]');
		ELSE
			SET r=CONCAT(r,'{"Push_MC":"',_email,'"},');
		END IF;
		
	END LOOP rLoop;-- 结束自定义循环体
	CLOSE r_name;-- 关闭游标
		SET result=r;-- 返回结果
		
END $$
DELIMITER;
```
```
-- 调用游标@sum变量为返回结果
call select_review(7,@sum);
-- 查询返回结果
select @sum e;
```

```
-- 分公司初审员工
-- 删除游标
drop procedure select_first_trial;
DELIMITER $$
CREATE PROCEDURE select_first_trial ( IN fgs BIGINT,OUT result VARCHAR(255)) 
BEGIN

	DECLARE _email VARCHAR(32);
	DECLARE i BIGINT;
	DECLARE r VARCHAR(255);
	DECLARE s BIGINT DEFAULT 0;
	-- 遍历数据结束标志
	DECLARE done INT DEFAULT FALSE;
	-- 游标
	DECLARE r_name CURSOR FOR (SELECT email FROM company c JOIN u_user u ON c.id=u.company_id JOIN u_user_role ur ON u.id=ur.uid WHERE ur.rid=6 AND c.id=fgs);
	-- 将结束标志绑定到游标
	DECLARE CONTINUE HANDLER FOR NOT FOUND SET done = TRUE;
	
	SELECT COUNT(nickname) INTO i FROM company c JOIN u_user u ON c.id=u.company_id JOIN u_user_role ur ON u.id=ur.uid WHERE ur.rid=6 AND c.id=fgs;
	
	-- 打开游标
	OPEN r_name;
	-- 遍历
	rLoop:LOOP
		-- 取值 赋值给变量，多个以,号分割
		FETCH r_name INTO _email;
		-- 判断是否继续循环
		IF done THEN
			LEAVE rLoop;-- 结束循环
		END IF;
		
		SET s=s+1;-- 循环一次加1
		IF(i=1) then
			SET r=CONCAT('[{"Push_MC":"',_email,'"}]');
		ELSEIF(s=1) THEN
			SET r=CONCAT('[{"Push_MC":"',_email,'"},');
		ELSEIF(s=i) THEN
			SET r=CONCAT(r,'{"Push_MC":"',_email,'"}]');
		ELSE
			SET r=CONCAT(r,'{"Push_MC":"',_email,'"},');
		END IF;
		
	END LOOP rLoop;-- 结束自定义循环体
	CLOSE r_name;-- 关闭游标
		SET result=r;-- 返回结果
END $$
DELIMITER;
```
```
-- 调用游标@sum变量为返回结果
call select_first_trial(42,@sum);
-- 查询返回结果
select @sum e;
```

